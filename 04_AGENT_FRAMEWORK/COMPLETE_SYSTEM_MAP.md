# ğŸ§  CENTRAL INTELLIGENCE SYSTEM - Complete Architecture Map
## Full System Diagram with All Components, Tables, Tools, and Data Flows

**Date**: 2025-10-08
**Version**: 2.0 (Universal Multi-Project)
**Status**: ğŸ¯ COMPLETE SYSTEM ARCHITECTURE

---

## ğŸ—ºï¸ COMPLETE SYSTEM ARCHITECTURE (Top-Level)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                          â”‚
â”‚                        ğŸŒ UNIVERSAL CENTRAL INTELLIGENCE SYSTEM                          â”‚
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          ğŸ’» CLIENT LAYER (Future)                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â”‚
â”‚  â”‚  â”‚  @lech/brain-cli â”‚  â”‚ @lech/brain-sdk  â”‚  â”‚  Web Dashboard   â”‚                 â”‚ â”‚
â”‚  â”‚  â”‚   (Not Built)    â”‚  â”‚   (Not Built)    â”‚  â”‚   (Not Built)    â”‚                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â†•                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ğŸ”Œ MCP PROTOCOL LAYER (JSON-RPC 2.0)                             â”‚ â”‚
â”‚  â”‚                                                                                      â”‚ â”‚
â”‚  â”‚  Transport: stdio (local) â†’ WebSocket (cloud future)                                â”‚ â”‚
â”‚  â”‚  Format: JSON-RPC 2.0 messages                                                      â”‚ â”‚
â”‚  â”‚  Tools: 11 registered tools (6 task + 4 intelligence + 1 discovery)                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â†•                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ğŸ§  CENTRAL INTELLIGENCE CORE (Node.js/TypeScript)                â”‚ â”‚
â”‚  â”‚                                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ” DISCOVERY ENGINE â­ NEW! (T001-T005 COMPLETE)                           â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ ProjectDetector (auto-detect projects)                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ ContextExtractor (auto-scan files)                                      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ AgentRecognizer (persistent identity)                                   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ JobProposalEngine (intelligent matching)                                â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ DiscoveryEngine (orchestrator)                                          â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“‹ TASK MANAGEMENT SYSTEM (Original - Operational)                         â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ TaskRegistry (coordination logic)                                       â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ TaskStore (SQLite persistence)                                          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ DependencyResolver (auto-unblocking)                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ GitTracker (verification)                                               â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ¤– AGENT INTELLIGENCE SYSTEM (Original - Operational)                      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ SessionManager (connection tracking)                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Activity Logger (all operations)                                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Presence Tracker (ONLINE/IDLE/OFFLINE)                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Metrics Aggregator (daily stats)                                        â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ”® FUTURE COMPONENTS (Not Yet Built)                                       â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ KeepInTouchEnforcer (completion gating) - T013                          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ ContextManager (cloud storage) - T011                                   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ ModelDiscovery (recommendation) - T015                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ BestPracticesEngine (quality) - T016                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ SwarmCoordinator (multi-swarm) - T014                                   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â†•                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ğŸ’¾ DATA LAYER (SQLite â†’ PostgreSQL Future)                       â”‚ â”‚
â”‚  â”‚                                                                                      â”‚ â”‚
â”‚  â”‚  Database: registry.db (143KB â†’ Growing)                                            â”‚ â”‚
â”‚  â”‚  Tables: 11 tables (3 task + 5 intelligence + 3 discovery)                          â”‚ â”‚
â”‚  â”‚  Operations: < 50ms per query                                                       â”‚ â”‚
â”‚  â”‚  Transactions: ACID-compliant                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DATABASE SCHEMA (11 Tables - Complete Map)

### **TASK MANAGEMENT TABLES (3 - Original)**

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: tasks (19 rows)                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PRIMARY KEY: id (TEXT) - e.g., "T001", "T019"                      â”‚
â”‚  COLUMNS:                                                            â”‚
â”‚    â”œâ”€ id: Task ID (T001-T030)                                       â”‚
â”‚    â”œâ”€ name: Task name                                               â”‚
â”‚    â”œâ”€ description: Full description                                 â”‚
â”‚    â”œâ”€ agent: Assigned agent (A/B/C/D/E/F)                           â”‚
â”‚    â”œâ”€ status: AVAILABLE/CLAIMED/IN_PROGRESS/COMPLETE/BLOCKED        â”‚
â”‚    â”œâ”€ priority: P0/P1/P2/P3                                         â”‚
â”‚    â”œâ”€ dependencies: JSON array of task IDs                          â”‚
â”‚    â”œâ”€ estimated_hours: Effort estimate                              â”‚
â”‚    â”œâ”€ actual_hours: Actual time spent                               â”‚
â”‚    â”œâ”€ velocity: Completion velocity (%)                             â”‚
â”‚    â”œâ”€ files_created: JSON array of file paths                       â”‚
â”‚    â”œâ”€ claimed_at: Timestamp                                         â”‚
â”‚    â”œâ”€ completed_at: Timestamp                                       â”‚
â”‚    â””â”€ project_id: Project reference â­ NEW!                          â”‚
â”‚                                                                      â”‚
â”‚  INDEXES:                                                            â”‚
â”‚    â”œâ”€ idx_tasks_status (status)                                     â”‚
â”‚    â”œâ”€ idx_tasks_agent (agent)                                       â”‚
â”‚    â”œâ”€ idx_tasks_priority (priority)                                 â”‚
â”‚    â””â”€ idx_tasks_project (project_id) â­ NEW!                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: task_history (0 rows - unused currently)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Audit log of task state changes                           â”‚
â”‚  COLUMNS: id, task_id, agent, status, timestamp, notes              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: migrations (5 rows)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Track applied database migrations                         â”‚
â”‚  COLUMNS: version, filename, applied_at                             â”‚
â”‚  ROWS: 001, 002, 003, 004, 005                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **AGENT INTELLIGENCE TABLES (5 - Original)**

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: agent_sessions (6 rows)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Track all agent connection sessions                       â”‚
â”‚  PRIMARY KEY: id (UUID)                                             â”‚
â”‚  COLUMNS:                                                            â”‚
â”‚    â”œâ”€ id: Session UUID                                              â”‚
â”‚    â”œâ”€ agent_letter: A/B/C/D/E/F                                     â”‚
â”‚    â”œâ”€ agent_model: Model ID                                         â”‚
â”‚    â”œâ”€ project_id: Project reference                                 â”‚
â”‚    â”œâ”€ connected_at: Connection timestamp                            â”‚
â”‚    â”œâ”€ disconnected_at: Disconnect timestamp                         â”‚
â”‚    â”œâ”€ last_heartbeat: Last heartbeat time                           â”‚
â”‚    â”œâ”€ machine_id: Machine identifier                                â”‚
â”‚    â”œâ”€ session_duration_minutes: Calculated on disconnect            â”‚
â”‚    â”œâ”€ total_queries: Query count                                    â”‚
â”‚    â”œâ”€ tasks_claimed: Tasks claimed in session                       â”‚
â”‚    â”œâ”€ tasks_completed: Tasks completed in session                   â”‚
â”‚    â””â”€ status: ACTIVE/IDLE/DISCONNECTED                              â”‚
â”‚                                                                      â”‚
â”‚  INDEXES:                                                            â”‚
â”‚    â”œâ”€ idx_sessions_agent (agent_letter)                             â”‚
â”‚    â”œâ”€ idx_sessions_status (status)                                  â”‚
â”‚    â”œâ”€ idx_sessions_connected (connected_at)                         â”‚
â”‚    â”œâ”€ idx_sessions_project (project_id)                             â”‚
â”‚    â””â”€ idx_sessions_project_agent (project_id, agent_letter) â­      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: agent_activity (14 rows)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Log every MCP operation                                   â”‚
â”‚  PRIMARY KEY: id (AUTOINCREMENT)                                    â”‚
â”‚  COLUMNS:                                                            â”‚
â”‚    â”œâ”€ id: Auto-increment                                            â”‚
â”‚    â”œâ”€ session_id: Foreign key â†’ agent_sessions                      â”‚
â”‚    â”œâ”€ agent_letter: A/B/C/D/E/F                                     â”‚
â”‚    â”œâ”€ timestamp: Operation time                                     â”‚
â”‚    â”œâ”€ activity_type: CONNECT/DISCONNECT/HEARTBEAT/QUERY/etc.        â”‚
â”‚    â”œâ”€ task_id: Related task (nullable)                              â”‚
â”‚    â”œâ”€ details: JSON details                                         â”‚
â”‚    â””â”€ duration_ms: Operation duration                               â”‚
â”‚                                                                      â”‚
â”‚  ACTIVITY TYPES:                                                     â”‚
â”‚    CONNECT, DISCONNECT, HEARTBEAT, QUERY, CLAIM,                    â”‚
â”‚    UPDATE, COMPLETE, COLLABORATE, ERROR                             â”‚
â”‚                                                                      â”‚
â”‚  INDEXES:                                                            â”‚
â”‚    â”œâ”€ idx_activity_session (session_id)                             â”‚
â”‚    â”œâ”€ idx_activity_agent (agent_letter)                             â”‚
â”‚    â”œâ”€ idx_activity_timestamp (timestamp)                            â”‚
â”‚    â”œâ”€ idx_activity_type (activity_type)                             â”‚
â”‚    â””â”€ idx_activity_task (task_id)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: agent_presence (6 rows - one per agent)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Real-time agent status (ONLINE/IDLE/OFFLINE)              â”‚
â”‚  PRIMARY KEY: agent_letter (A/B/C/D/E/F)                            â”‚
â”‚  COLUMNS:                                                            â”‚
â”‚    â”œâ”€ agent_letter: A/B/C/D/E/F (PRIMARY KEY)                       â”‚
â”‚    â”œâ”€ status: ONLINE/IDLE/OFFLINE                                   â”‚
â”‚    â”œâ”€ current_session_id: Active session UUID                       â”‚
â”‚    â”œâ”€ current_task_id: Current task                                 â”‚
â”‚    â”œâ”€ last_seen: Last heartbeat time                                â”‚
â”‚    â”œâ”€ online_since: When went online                                â”‚
â”‚    â”œâ”€ total_sessions_today: Daily session count                     â”‚
â”‚    â”œâ”€ total_active_time_minutes: Daily active time                  â”‚
â”‚    â””â”€ tasks_today: Tasks completed today                            â”‚
â”‚                                                                      â”‚
â”‚  FOREIGN KEYS:                                                       â”‚
â”‚    â”œâ”€ current_session_id â†’ agent_sessions(id)                       â”‚
â”‚    â””â”€ current_task_id â†’ tasks(id)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: agent_metrics (2 rows)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Daily performance aggregation                             â”‚
â”‚  PRIMARY KEY: id (AUTOINCREMENT)                                    â”‚
â”‚  UNIQUE: (agent_letter, metric_date)                                â”‚
â”‚  COLUMNS:                                                            â”‚
â”‚    â”œâ”€ id: Auto-increment                                            â”‚
â”‚    â”œâ”€ agent_letter: A/B/C/D/E/F                                     â”‚
â”‚    â”œâ”€ metric_date: Date (YYYY-MM-DD)                                â”‚
â”‚    â”œâ”€ total_sessions: Sessions on this day                          â”‚
â”‚    â”œâ”€ total_active_minutes: Active time                             â”‚
â”‚    â”œâ”€ tasks_claimed: Tasks claimed                                  â”‚
â”‚    â”œâ”€ tasks_completed: Tasks completed                              â”‚
â”‚    â”œâ”€ average_task_minutes: Avg time per task                       â”‚
â”‚    â”œâ”€ velocity_score: Performance score                             â”‚
â”‚    â”œâ”€ quality_score: Quality rating                                 â”‚
â”‚    â””â”€ collaboration_score: Collaboration rating                     â”‚
â”‚                                                                      â”‚
â”‚  INDEX: idx_metrics_agent_date (agent_letter, metric_date)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: agent_collaboration (0 rows - future use)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Track cross-agent collaboration events                    â”‚
â”‚  COLUMNS: id, timestamp, agent_from, agent_to,                      â”‚
â”‚           collaboration_type, task_id, details                       â”‚
â”‚  TYPES: HANDOFF, REVIEW, ASSIST, COORDINATE, QUESTION, ANSWER       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **DISCOVERY TABLES (3 - New!)**

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: projects (1 row) â­ NEW! Migration 003                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Multi-project registry (unlimited projects)               â”‚
â”‚  PRIMARY KEY: id (UUID)                                             â”‚
â”‚  UNIQUE: path, git_remote                                           â”‚
â”‚  COLUMNS:                                                            â”‚
â”‚    â”œâ”€ id: Project UUID                                              â”‚
â”‚    â”œâ”€ name: Project name (e.g., "LocalBrain")                       â”‚
â”‚    â”œâ”€ path: Absolute path to project                                â”‚
â”‚    â”œâ”€ git_remote: Git remote URL (normalized)                       â”‚
â”‚    â”œâ”€ type: COMMERCIAL_APP/KNOWLEDGE_SYSTEM/TOOL/etc.               â”‚
â”‚    â”œâ”€ vision: Extracted from CLAUDE.md                              â”‚
â”‚    â”œâ”€ created_at: First discovered                                  â”‚
â”‚    â”œâ”€ last_activity: Last agent activity                            â”‚
â”‚    â”œâ”€ discovered_by: auto/manual                                    â”‚
â”‚    â””â”€ metadata: JSON (technologies, size, flags)                    â”‚
â”‚                                                                      â”‚
â”‚  PROJECT TYPES:                                                      â”‚
â”‚    COMMERCIAL_APP, KNOWLEDGE_SYSTEM, TOOL,                          â”‚
â”‚    INFRASTRUCTURE, EXPERIMENTAL, UNKNOWN                             â”‚
â”‚                                                                      â”‚
â”‚  INDEXES:                                                            â”‚
â”‚    â”œâ”€ idx_projects_name (name)                                      â”‚
â”‚    â”œâ”€ idx_projects_type (type)                                      â”‚
â”‚    â”œâ”€ idx_projects_activity (last_activity)                         â”‚
â”‚    â””â”€ idx_projects_git_remote (git_remote)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: agents (1 row) â­ NEW! Migration 004                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Persistent agent identity across all sessions             â”‚
â”‚  PRIMARY KEY: id (UUID)                                             â”‚
â”‚  UNIQUE: tracking_id                                                â”‚
â”‚  COLUMNS:                                                            â”‚
â”‚    â”œâ”€ id: Agent UUID                                                â”‚
â”‚    â”œâ”€ tracking_id: Unique tracking identifier                       â”‚
â”‚    â”œâ”€ name: Agent name (e.g., "Agent-Sonnet-xxx")                   â”‚
â”‚    â”œâ”€ model_id: Model identifier                                    â”‚
â”‚    â”œâ”€ model_signature: Fingerprint for recognition                  â”‚
â”‚    â”œâ”€ capabilities: JSON (ui, backend, design, etc.)                â”‚
â”‚    â”œâ”€ created_at: First seen                                        â”‚
â”‚    â”œâ”€ last_seen: Last activity                                      â”‚
â”‚    â”œâ”€ total_sessions: Lifetime session count                        â”‚
â”‚    â”œâ”€ total_tasks: Lifetime task count                              â”‚
â”‚    â””â”€ metadata: JSON (preferences, roles, stats)                    â”‚
â”‚                                                                      â”‚
â”‚  INDEXES:                                                            â”‚
â”‚    â”œâ”€ idx_agents_tracking (tracking_id) - Primary lookup            â”‚
â”‚    â”œâ”€ idx_agents_signature (model_signature) - Secondary lookup     â”‚
â”‚    â”œâ”€ idx_agents_model (model_id)                                   â”‚
â”‚    â””â”€ idx_agents_last_seen (last_seen)                              â”‚
â”‚                                                                      â”‚
â”‚  STORED IN: ~/.brain/config.json (local machine)                    â”‚
â”‚    {                                                                 â”‚
â”‚      "trackingId": "uuid-xxx",                                      â”‚
â”‚      "agentId": "uuid-yyy",                                         â”‚
â”‚      "registeredAt": "2025-10-08T..."                               â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: context_files (0 rows) â­ NEW! Migration 005                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Store extracted context files for all projects            â”‚
â”‚  PRIMARY KEY: id (UUID)                                             â”‚
â”‚  UNIQUE: (project_id, relative_path)                                â”‚
â”‚  COLUMNS:                                                            â”‚
â”‚    â”œâ”€ id: File UUID                                                 â”‚
â”‚    â”œâ”€ project_id: Foreign key â†’ projects(id)                        â”‚
â”‚    â”œâ”€ relative_path: Path relative to project root                  â”‚
â”‚    â”œâ”€ absolute_path: Full file path                                 â”‚
â”‚    â”œâ”€ type: SPEC/DOC/CODE/ARCHITECTURE/STATUS/CONFIG/ASSET          â”‚
â”‚    â”œâ”€ size: File size in bytes                                      â”‚
â”‚    â”œâ”€ created_at: File creation time                                â”‚
â”‚    â”œâ”€ modified_at: File modification time                           â”‚
â”‚    â”œâ”€ content_hash: Simple hash (size-mtime)                        â”‚
â”‚    â””â”€ indexed_at: When indexed in database                          â”‚
â”‚                                                                      â”‚
â”‚  FILE TYPES:                                                         â”‚
â”‚    SPEC, DOC, CODE, ARCHITECTURE, STATUS,                           â”‚
â”‚    CONFIG, ASSET, UNKNOWN                                           â”‚
â”‚                                                                      â”‚
â”‚  INDEXES:                                                            â”‚
â”‚    â”œâ”€ idx_context_project (project_id)                              â”‚
â”‚    â”œâ”€ idx_context_type (type)                                       â”‚
â”‚    â”œâ”€ idx_context_modified (modified_at)                            â”‚
â”‚    â””â”€ idx_context_path (project_id, relative_path)                  â”‚
â”‚                                                                      â”‚
â”‚  FOREIGN KEY: project_id â†’ projects(id) CASCADE DELETE              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ MCP TOOLS (11 Total - Complete Registry)

### **TASK MANAGEMENT TOOLS (6 - Original)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£  get_available_tasks                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Query tasks ready for specific agent                       â”‚
â”‚  INPUT: { agent: "A"|"B"|"C"|"D"|"E"|"F" }                          â”‚
â”‚  OUTPUT: List of available tasks with dependencies satisfied         â”‚
â”‚  LOGIC: Filters by agent, status=AVAILABLE, deps satisfied          â”‚
â”‚  USES: TaskRegistry.getAvailableTasks()                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£  claim_task                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Atomically claim a task                                    â”‚
â”‚  INPUT: { taskId: "T001", agent: "A" }                              â”‚
â”‚  OUTPUT: Success/failure with claimed_at timestamp                   â”‚
â”‚  LOGIC: ACID transaction, checks status=AVAILABLE, updates to CLAIMEDâ”‚
â”‚  USES: TaskRegistry.claimTask() â†’ TaskStore (atomic)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£  update_progress                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Update task progress in real-time                          â”‚
â”‚  INPUT: { taskId, status, completionPercent, filesCreated, notes }  â”‚
â”‚  OUTPUT: Updated task with Git verification                          â”‚
â”‚  LOGIC: Updates status to IN_PROGRESS, tracks files, runs GitTrackerâ”‚
â”‚  USES: TaskRegistry â†’ TaskStore + GitTracker                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ï¸âƒ£  complete_task                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Mark task complete with Git verification                   â”‚
â”‚  INPUT: { taskId, agent, filesCreated, velocity }                   â”‚
â”‚  OUTPUT: Completion confirmation + unlocked tasks                    â”‚
â”‚  LOGIC: Git verification (70% files + 30% commits â‰¥80%)             â”‚
â”‚  USES: TaskRegistry.completeTask() â†’ Auto-unblock dependencies      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5ï¸âƒ£  get_dashboard                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Multi-agent dashboard with beautiful CLI UI                â”‚
â”‚  INPUT: { project?: "projectId" }                                   â”‚
â”‚  OUTPUT: Sprint metrics, agent status, task breakdown (ASCII art)    â”‚
â”‚  LOGIC: Aggregates from tasks + agent_sessions + GitTracker         â”‚
â”‚  USES: TaskRegistry.getSprintMetrics() + GitTracker                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6ï¸âƒ£  get_agent_status                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Individual agent deep dive with Git activity               â”‚
â”‚  INPUT: { agent: "A" }                                              â”‚
â”‚  OUTPUT: Agent workload, Git activity, performance (ASCII art)       â”‚
â”‚  LOGIC: Queries tasks by agent + GitTracker.getAgentActivity()      â”‚
â”‚  USES: TaskRegistry.getAgentWorkload() + GitTracker                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **INTELLIGENCE TOOLS (4 - Original)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7ï¸âƒ£  agent_connect                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Register new agent session                                 â”‚
â”‚  INPUT: { agent: "A", model: "GLM-4.6", project: "LocalBrain" }     â”‚
â”‚  OUTPUT: Session UUID + welcome message + available tasks count      â”‚
â”‚  LOGIC: Creates session, updates presence to ONLINE, logs activity   â”‚
â”‚  USES: SessionManager.createSession()                               â”‚
â”‚  SIDE EFFECTS:                                                       â”‚
â”‚    â”œâ”€ Closes duplicate session if exists (BUG FIX #2)               â”‚
â”‚    â”œâ”€ INSERT INTO agent_sessions                                    â”‚
â”‚    â”œâ”€ UPDATE agent_presence (status=ONLINE)                         â”‚
â”‚    â””â”€ INSERT INTO agent_activity (type=CONNECT)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8ï¸âƒ£  agent_heartbeat                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Update agent presence (every 30 seconds)                   â”‚
â”‚  INPUT: { sessionId: "uuid", currentActivity?: "IDLE" }             â”‚
â”‚  OUTPUT: Heartbeat acknowledgement                                   â”‚
â”‚  LOGIC: Updates last_heartbeat, last_seen, status (ACTIVE/IDLE)     â”‚
â”‚  USES: SessionManager.updateHeartbeat()                             â”‚
â”‚  SIDE EFFECTS:                                                       â”‚
â”‚    â”œâ”€ UPDATE agent_sessions (last_heartbeat, status)                â”‚
â”‚    â”œâ”€ UPDATE agent_presence (last_seen, status)                     â”‚
â”‚    â””â”€ INSERT INTO agent_activity (type=HEARTBEAT)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9ï¸âƒ£  agent_disconnect                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Close agent session                                        â”‚
â”‚  INPUT: { sessionId: "uuid" }                                       â”‚
â”‚  OUTPUT: Session duration + stats                                    â”‚
â”‚  LOGIC: Calculates duration, updates metrics, closes session         â”‚
â”‚  USES: SessionManager.closeSession()                                â”‚
â”‚  SIDE EFFECTS:                                                       â”‚
â”‚    â”œâ”€ UPDATE agent_sessions (disconnected_at, duration, status)     â”‚
â”‚    â”œâ”€ UPDATE agent_presence (status=OFFLINE, active_time)           â”‚
â”‚    â”œâ”€ INSERT INTO agent_activity (type=DISCONNECT)                  â”‚
â”‚    â””â”€ INSERT/UPDATE agent_metrics (daily aggregation)               â”‚
â”‚  BUG FIX: Fetches session AFTER closeSession (not before) #1        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Ÿ get_swarm_dashboard                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Real-time view of all agents in swarm                      â”‚
â”‚  INPUT: { project?: "projectId" }                                   â”‚
â”‚  OUTPUT: Swarm summary + agent details + recent activity             â”‚
â”‚  LOGIC: Joins agent_presence + agent_sessions + tasks               â”‚
â”‚  USES: Multi-table query with timeout detection                     â”‚
â”‚  SIDE EFFECTS:                                                       â”‚
â”‚    â””â”€ UPDATE agent_presence (status=OFFLINE if heartbeat timeout)   â”‚
â”‚       (Checks datetime(last_seen) < datetime('now', '-120 seconds')) â”‚
â”‚  BUG FIX: Automatic timeout detection for zombie agents #3          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **DISCOVERY TOOLS (1 - New!)** â­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£1ï¸âƒ£ discover_environment â­ NEW! PLUG-N-PLAY                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PURPOSE: Complete automatic environment discovery                   â”‚
â”‚  INPUT: {                                                            â”‚
â”‚    cwd: "/Users/lech/PROJECTS_all/LocalBrain",                      â”‚
â”‚    modelId: "claude-sonnet-4-5",                                    â”‚
â”‚    trackingId?: "uuid-from-config" // Optional                      â”‚
â”‚  }                                                                   â”‚
â”‚  OUTPUT: {                                                           â”‚
â”‚    agent: { id, trackingId, name, capabilities },                   â”‚
â”‚    agentIdentity: { recognized, method, confidence },               â”‚
â”‚    project: { id, name, type, vision },                             â”‚
â”‚    context: { totalFiles, categories, statistics },                 â”‚
â”‚    proposals: [{ taskId, matchScore, relevantContext }]             â”‚
â”‚  }                                                                   â”‚
â”‚  LOGIC: 4-step discovery flow                                       â”‚
â”‚    1. Recognize/create agent (AgentRecognizer)                      â”‚
â”‚    2. Detect/register project (ProjectDetector)                     â”‚
â”‚    3. Extract context (ContextExtractor)                            â”‚
â”‚    4. Generate proposals (JobProposalEngine)                        â”‚
â”‚  USES: DiscoveryEngine.discoverEnvironment()                        â”‚
â”‚  TIME: ~20-60 seconds (needs optimization)                          â”‚
â”‚  SIDE EFFECTS:                                                       â”‚
â”‚    â”œâ”€ INSERT INTO agents (if new)                                   â”‚
â”‚    â”œâ”€ INSERT INTO projects (if new)                                 â”‚
â”‚    â”œâ”€ INSERT INTO context_files (bulk insert)                       â”‚
â”‚    â””â”€ WRITE ~/.brain/config.json (tracking ID)                      â”‚
â”‚                                                                      â”‚
â”‚  THIS IS THE REVOLUTION: ONE CALL â†’ EVERYTHING DISCOVERED! ğŸš€        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ COMPLETE DATA FLOW DIAGRAM

### **Discovery Flow (New Agent, New Project)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Agent Connection Attempt                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
         Agent calls: discover_environment({
           cwd: "/Users/lech/PROJECTS_all/AudioAnalyzer",
           modelId: "claude-sonnet-4-5"
         })
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Agent Recognition (AgentRecognizer)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ Read ~/.brain/config.json                                        â”‚
â”‚    âŒ Not found (new agent)                                          â”‚
â”‚                                                                      â”‚
â”‚  â†’ Generate model signature                                         â”‚
â”‚    hash(modelId + apiKeyHash + machineId)                           â”‚
â”‚                                                                      â”‚
â”‚  â†’ Query: SELECT * FROM agents WHERE model_signature = ?            â”‚
â”‚    âŒ Not found                                                      â”‚
â”‚                                                                      â”‚
â”‚  â†’ Create new agent:                                                â”‚
â”‚    INSERT INTO agents (id, tracking_id, name, model_id, ...)        â”‚
â”‚    WRITE ~/.brain/config.json with tracking_id                      â”‚
â”‚                                                                      â”‚
â”‚  âœ… Result: New agent created with tracking ID                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Project Detection (ProjectDetector)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ Get git remote:                                                   â”‚
â”‚    exec: git remote get-url origin                                  â”‚
â”‚    Result: github.com/lech/audio-analyzer                           â”‚
â”‚                                                                      â”‚
â”‚  â†’ Query: SELECT * FROM projects WHERE git_remote = ?               â”‚
â”‚    âŒ Not found                                                      â”‚
â”‚                                                                      â”‚
â”‚  â†’ Detect project metadata:                                         â”‚
â”‚    - Check for CLAUDE.md âœ…                                          â”‚
â”‚    - Check for package.json âœ…                                       â”‚
â”‚    - Check for 02_SPECBASES âŒ                                       â”‚
â”‚    - Classify type: TOOL                                            â”‚
â”‚    - Extract vision from CLAUDE.md                                  â”‚
â”‚                                                                      â”‚
â”‚  â†’ Create project:                                                   â”‚
â”‚    INSERT INTO projects (id, name, path, git_remote, type, ...)     â”‚
â”‚                                                                      â”‚
â”‚  âœ… Result: New project registered (AudioAnalyzer)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Context Extraction (ContextExtractor)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ Scan directories:                                                 â”‚
â”‚    find ./docs -type f â†’ 23 files                                   â”‚
â”‚    find ./src -type f â†’ 45 files                                    â”‚
â”‚    find . -name "*ARCHITECTURE*" â†’ 3 files                          â”‚
â”‚                                                                      â”‚
â”‚  â†’ Categorize files:                                                 â”‚
â”‚    specs: 8 files                                                    â”‚
â”‚    docs: 23 files                                                    â”‚
â”‚    code: 45 files                                                    â”‚
â”‚    config: 3 files                                                   â”‚
â”‚                                                                      â”‚
â”‚  â†’ Extract metadata:                                                 â”‚
â”‚    Total size: 2.3 MB                                               â”‚
â”‚    LOC: 4,500 lines                                                  â”‚
â”‚    Technologies: TypeScript, React                                   â”‚
â”‚                                                                      â”‚
â”‚  â†’ Store in database:                                                â”‚
â”‚    INSERT INTO context_files (79 files in transaction)              â”‚
â”‚                                                                      â”‚
â”‚  âœ… Result: 79 files indexed and ready                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Job Proposal Generation (JobProposalEngine)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ Query available tasks:                                            â”‚
â”‚    SELECT * FROM tasks WHERE project_id = ? AND status = 'AVAILABLE'â”‚
â”‚    Result: 5 tasks                                                   â”‚
â”‚                                                                      â”‚
â”‚  â†’ Score each task for this agent:                                  â”‚
â”‚    Task 1: 92/100 (UI development - good match)                     â”‚
â”‚    Task 2: 85/100 (Backend work - medium match)                     â”‚
â”‚    Task 3: 78/100 (Integration - good match)                        â”‚
â”‚    Task 4: 65/100 (Design - low match)                              â”‚
â”‚    Task 5: 45/100 (Infrastructure - low match)                      â”‚
â”‚                                                                      â”‚
â”‚  â†’ Find relevant context for each:                                  â”‚
â”‚    Task 1: 15 relevant files (specs + code examples)                â”‚
â”‚    Task 2: 8 relevant files                                         â”‚
â”‚    ...                                                               â”‚
â”‚                                                                      â”‚
â”‚  â†’ Rank by score:                                                    â”‚
â”‚    Proposals: [Task1(92%), Task3(78%), Task2(85%), ...]             â”‚
â”‚                                                                      â”‚
â”‚  âœ… Result: 5 ranked job proposals with context                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Return Complete Package                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  {                                                                   â”‚
â”‚    agent: { id, trackingId, name, capabilities },                   â”‚
â”‚    project: { id, name, type, vision },                             â”‚
â”‚    context: { 79 files indexed },                                   â”‚
â”‚    proposals: [                                                      â”‚
â”‚      { task1: 92% match, 15 context files },                        â”‚
â”‚      { task3: 85% match, 12 context files },                        â”‚
â”‚      { task2: 78% match, 8 context files }                          â”‚
â”‚    ]                                                                 â”‚
â”‚  }                                                                   â”‚
â”‚                                                                      â”‚
â”‚  âœ… Agent activated and ready to work!                               â”‚
â”‚  âœ… Total time: 22 seconds                                           â”‚
â”‚  âœ… Manual steps: ZERO                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ COMPONENT ARCHITECTURE (Detailed)

### **Core Components (src/)**

```
src/
â”œâ”€ index.ts (Server Entry Point)
â”‚  â””â”€ Initializes: TaskRegistry, GitTracker, SessionManager, DiscoveryEngine
â”‚
â”œâ”€ registry/ (Task Management - Original)
â”‚  â”œâ”€ TaskRegistry.ts (Coordination logic, 260 LOC)
â”‚  â”‚  â””â”€ Methods: initialize(), getAllTasks(), getAvailableTasks(),
â”‚  â”‚              claimTask(), completeTask(), getSprintMetrics()
â”‚  â”‚
â”‚  â”œâ”€ TaskStore.ts (SQLite persistence, 350 LOC)
â”‚  â”‚  â””â”€ Methods: getAllTasks(), getTask(), claimTask(),
â”‚  â”‚              updateTaskStatus(), completeTask()
â”‚  â”‚
â”‚  â”œâ”€ DependencyResolver.ts (Dependency logic, 200 LOC)
â”‚  â”‚  â””â”€ Methods: areDependenciesSatisfied(), detectCircularDependencies(),
â”‚  â”‚              getCriticalPath(), findTasksToUnblock()
â”‚  â”‚
â”‚  â””â”€ GitTracker.ts (Git verification, 250 LOC)
â”‚     â””â”€ Methods: getFileTimestamps(), getCommitHistory(),
â”‚                 calculateCompletionScore(), getAgentActivity()
â”‚
â”œâ”€ intelligence/ (Agent Intelligence - Original)
â”‚  â””â”€ SessionManager.ts (Session tracking, 270 LOC)
â”‚     â””â”€ Methods: createSession(), updateHeartbeat(), closeSession(),
â”‚                 getSession(), incrementTasksClaimed(), logActivity()
â”‚
â”œâ”€ discovery/ (Discovery Engine - NEW! â­)
â”‚  â”œâ”€ DiscoveryEngine.ts (Main orchestrator, 200 LOC)
â”‚  â”‚  â””â”€ Method: discoverEnvironment() â† MAIN ENTRY POINT
â”‚  â”‚             â””â”€ Orchestrates all 4 discovery components
â”‚  â”‚
â”‚  â”œâ”€ ProjectDetector.ts (Project detection, 300 LOC)
â”‚  â”‚  â””â”€ Methods: detectProject(), getGitRemote(), classifyProjectType(),
â”‚  â”‚              extractVision(), getAllProjects(), searchProjects()
â”‚  â”‚
â”‚  â”œâ”€ ContextExtractor.ts (Context scanning, 400 LOC)
â”‚  â”‚  â””â”€ Methods: extractContext(), scanProjectDirectory(),
â”‚  â”‚              categorizeFiles(), getContextFiles(), searchContextFiles()
â”‚  â”‚
â”‚  â”œâ”€ AgentRecognizer.ts (Agent identity, 350 LOC)
â”‚  â”‚  â””â”€ Methods: recognizeAgent(), findByTrackingId(), createNewAgent(),
â”‚  â”‚              extractCapabilitiesFromModel(), saveTrackingIdToConfig()
â”‚  â”‚
â”‚  â”œâ”€ JobProposalEngine.ts (Task matching, 250 LOC)
â”‚  â”‚  â””â”€ Methods: generateProposals(), scoreTask(), findRelevantContext(),
â”‚  â”‚              explainMatch(), calculateImpact()
â”‚  â”‚
â”‚  â””â”€ index.ts (Exports)
â”‚
â”œâ”€ tools/ (MCP Tool Implementations)
â”‚  â”œâ”€ getAvailableTasks.ts (120 LOC)
â”‚  â”œâ”€ claimTask.ts (150 LOC)
â”‚  â”œâ”€ updateProgress.ts (180 LOC)
â”‚  â”œâ”€ completeTask.ts (200 LOC)
â”‚  â”œâ”€ getDashboard.ts (350 LOC)
â”‚  â”œâ”€ getAgentStatus.ts (300 LOC)
â”‚  â”‚
â”‚  â”œâ”€ intelligence/
â”‚  â”‚  â”œâ”€ agentConnect.ts (150 LOC)
â”‚  â”‚  â”œâ”€ agentHeartbeat.ts (80 LOC)
â”‚  â”‚  â”œâ”€ agentDisconnect.ts (100 LOC)
â”‚  â”‚  â””â”€ getSwarmDashboard.ts (125 LOC)
â”‚  â”‚
â”‚  â”œâ”€ discovery/ â­ NEW!
â”‚  â”‚  â””â”€ discoverEnvironment.ts (150 LOC)
â”‚  â”‚
â”‚  â””â”€ index.ts (Tool registration, 90 LOC)
â”‚
â”œâ”€ database/
â”‚  â””â”€ migrations/
â”‚     â”œâ”€ 001_initial_schema.sql (Tasks)
â”‚     â”œâ”€ 002_agent_intelligence.sql (Intelligence)
â”‚     â”œâ”€ 003_projects_table.sql (Multi-project) â­
â”‚     â”œâ”€ 004_agents_table.sql (Persistent identity) â­
â”‚     â””â”€ 005_context_files_table.sql (Context storage) â­
â”‚
â”œâ”€ types/
â”‚  â””â”€ Task.ts (Type definitions, 150 LOC)
â”‚
â””â”€ utils/
   â””â”€ logger.ts (Logging, 75 LOC)

Total: ~7,100 LOC (was 5,600, +1,500 new)
```

---

## ğŸ”„ COMPLETE OPERATION FLOWS

### **Flow 1: Agent First Connection (New Agent, New Project)**

```
Agent runs from new project directory:
  â”œâ”€ cwd: /Users/lech/PROJECTS_all/AudioAnalyzer
  â””â”€ No ~/.brain/config.json

1. discover_environment called
   â†“
2. AgentRecognizer.recognizeAgent()
   â†’ No tracking ID
   â†’ No signature match
   â†’ Creates NEW agent
   â†’ Generates tracking_id: "uuid-xxx"
   â†’ INSERT INTO agents
   â†’ WRITE ~/.brain/config.json
   âœ… Agent created
   â†“
3. ProjectDetector.detectProject()
   â†’ Get git remote: github.com/lech/audio-analyzer
   â†’ Query projects: Not found
   â†’ Detect type: TOOL
   â†’ Extract vision from CLAUDE.md
   â†’ INSERT INTO projects
   âœ… Project registered
   â†“
4. ContextExtractor.extractContext()
   â†’ Scan ./docs (23 files)
   â†’ Scan ./src (45 files)
   â†’ Categorize by type
   â†’ INSERT INTO context_files (79 files)
   âœ… Context indexed
   â†“
5. JobProposalEngine.generateProposals()
   â†’ Query tasks: 5 available
   â†’ Score each task
   â†’ Find relevant context
   â†’ Rank by score
   âœ… 5 proposals generated
   â†“
6. Return complete package
   âœ… Agent activated with tracking ID
   âœ… Project auto-registered
   âœ… 79 files indexed
   âœ… 5 job proposals ready
   âœ… Total time: 22 seconds
```

### **Flow 2: Agent Reconnection (Existing Agent, Known Project)**

```
Agent returns to known project:
  â”œâ”€ cwd: /Users/lech/PROJECTS_all/LocalBrain
  â””â”€ Has ~/.brain/config.json with tracking_id

1. discover_environment called with trackingId
   â†“
2. AgentRecognizer.recognizeAgent()
   â†’ Read tracking_id from config
   â†’ Query: SELECT * FROM agents WHERE tracking_id = ?
   âœ… FOUND! (100% confidence)
   â†’ Load agent history (47 sessions, 23 tasks)
   â†’ UPDATE last_seen
   âœ… Agent recognized
   â†“
3. ProjectDetector.detectProject()
   â†’ Get git remote: github.com/leolech14/LocalBrain
   â†’ Query: SELECT * FROM projects WHERE git_remote = ?
   âœ… FOUND! (existing project)
   â†’ UPDATE last_activity
   âœ… Project recognized
   â†“
4. ContextExtractor (Smart Check)
   â†’ Query: SELECT * FROM context_files WHERE project_id = ?
   âœ… Found 1,334 files (already indexed)
   â†’ Check if needs update:
     - Compare file counts: 1,334 stored vs 1,338 actual (4 new files)
     - Check CLAUDE.md modified: No change
   â†’ Decision: UPDATE needed (4 new files)
   â†’ Scan only new files
   â†’ INSERT 4 new files
   âœ… Context updated (fast - only 4 files scanned)
   â†“
5. JobProposalEngine.generateProposals()
   â†’ Query tasks: 5 available (T020-T024)
   â†’ Score for Agent D capabilities
   â†’ Use agent history (prefers integration tasks)
   â†’ Rank by score
   âœ… 5 proposals (T020: 95% match - top recommendation)
   â†“
6. Return complete package
   âœ… Agent recognized (47 previous sessions!)
   âœ… Project recognized
   âœ… Context updated (1,338 files, 4 new)
   âœ… 5 proposals (T020 highly recommended)
   âœ… Total time: 8 seconds (cached context!)
```

### **Flow 3: Multi-Project Agent Movement**

```
Agent D working in LocalBrain, switches to Gov.br:

Session 1: LocalBrain
  â†’ discover_environment({ cwd: "/Users/lech/PROJECTS_all/LocalBrain" })
  â†’ Recognized: Agent D
  â†’ Project: LocalBrain
  â†’ Role: Integration Specialist
  â†’ Tasks: 5 available
  âœ… Working on T020

Session 2: Gov.br (same day)
  â†’ discover_environment({ cwd: "/Users/lech/PROJECTS_all/PROJECT_govbr" })
  â†’ Recognized: Agent D (SAME tracking ID!)
  â†’ Project: Gov.br (different project!)
  â†’ Role: Backend Specialist (different role!)
  â†’ Tasks: 12 available (Gov.br tasks)
  âœ… Context switched seamlessly

Database shows:
  â”œâ”€ Agent D: 2 sessions today (LocalBrain + Gov.br)
  â”œâ”€ Projects: Both tracked separately
  â”œâ”€ Context: Isolated by project
  â””â”€ Proposals: Role-specific for each project
```

---

## ğŸ“Š DATABASE RELATIONSHIPS (Complete ER Diagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  projects   â”‚ (Multi-Project Registry)
â”‚             â”‚
â”‚ PK: id      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UK: path    â”‚                â”‚
â”‚ UK: git_remote              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
       â†‘                        â”‚
       â”‚ FK                     â”‚ FK
       â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚context_filesâ”‚          â”‚    tasks    â”‚ (Project-Scoped Tasks)
â”‚             â”‚          â”‚             â”‚
â”‚ PK: id      â”‚          â”‚ PK: id      â”‚
â”‚ FK: project_id         â”‚ FK: project_id
â”‚ UK: (project_id,       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚      relative_path)           â†‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ FK
                                 â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ task_historyâ”‚ (Audit Log)
                          â”‚             â”‚
                          â”‚ FK: task_id â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   agents    â”‚ (Persistent Identity)
â”‚             â”‚
â”‚ PK: id      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UK: tracking_id             â”‚
â”‚ UK: model_signature         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
       â†‘                        â”‚
       â”‚                        â”‚
       â”‚ Referenced             â”‚ Referenced
       â”‚ (not FK)               â”‚ (not FK)
       â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚agent_sessions          â”‚agent_presence (Real-time Status)
â”‚             â”‚          â”‚             â”‚
â”‚ PK: id      â”‚          â”‚ PK: agent_letter (A/B/C/D/E/F)
â”‚ agent_letterâ”‚          â”‚ FK: current_session_id â†’ agent_sessions
â”‚ (links to   â”‚          â”‚ FK: current_task_id â†’ tasks
â”‚  agents via â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  name match)â”‚
â”‚ FK: project_id
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘
       â”‚ FK
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚agent_activity          â”‚agent_metricsâ”‚ (Daily Aggregation)
â”‚             â”‚          â”‚             â”‚
â”‚ FK: session_id         â”‚ agent_letterâ”‚
â”‚ FK: task_id â”‚          â”‚ metric_date â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ UK: (agent_letter, metric_date)
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚agent_collaboration (Future)
â”‚             â”‚
â”‚ agent_from  â”‚
â”‚ agent_to    â”‚
â”‚ FK: task_id â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL: 11 tables with 15 foreign key relationships
```

---

## ğŸ¯ COMPONENT INTERACTION MAP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCP SERVER (src/index.ts)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Initializes:                                                            â”‚
â”‚    1. TaskRegistry (task coordination)                                  â”‚
â”‚    2. GitTracker (verification)                                         â”‚
â”‚    3. Database (registry.db)                                            â”‚
â”‚    4. MCP Server (stdio transport)                                      â”‚
â”‚  Registers:                                                              â”‚
â”‚    11 MCP tools via registerTools()                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ uses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DISCOVERY ENGINE â­                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Entry: discover_environment MCP tool                                   â”‚
â”‚  Orchestrates: 4 discovery components                                   â”‚
â”‚  Returns: Complete environment package                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚              â”‚
       â”‚              â”‚              â”‚              â”‚
       â†“              â†“              â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Project      â”‚ â”‚ Context      â”‚ â”‚ Agent        â”‚ â”‚ Job Proposal â”‚
â”‚ Detector     â”‚ â”‚ Extractor    â”‚ â”‚ Recognizer   â”‚ â”‚ Engine       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Detects:     â”‚ â”‚ Scans:       â”‚ â”‚ Recognizes:  â”‚ â”‚ Scores:      â”‚
â”‚ - Git remote â”‚ â”‚ - Specs      â”‚ â”‚ - Tracking   â”‚ â”‚ - Role match â”‚
â”‚ - Path       â”‚ â”‚ - Docs       â”‚ â”‚ - Signature  â”‚ â”‚ - Capability â”‚
â”‚ - Type       â”‚ â”‚ - Code       â”‚ â”‚ Creates:     â”‚ â”‚ - History    â”‚
â”‚ - Vision     â”‚ â”‚ - Arch       â”‚ â”‚ - New agents â”‚ â”‚ - Context    â”‚
â”‚ Stores in:   â”‚ â”‚ Stores in:   â”‚ â”‚ Stores in:   â”‚ â”‚ - Readiness  â”‚
â”‚ - projects   â”‚ â”‚ - context_   â”‚ â”‚ - agents     â”‚ â”‚ - Urgency    â”‚
â”‚   table      â”‚ â”‚   files      â”‚ â”‚   table      â”‚ â”‚ Returns:     â”‚
â”‚              â”‚ â”‚   table      â”‚ â”‚ - ~/.brain/  â”‚ â”‚ - Ranked     â”‚
â”‚              â”‚ â”‚              â”‚ â”‚   config     â”‚ â”‚   proposals  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ TASK LIFECYCLE (Complete Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TASK LIFECYCLE: From Discovery to Completion                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PHASE 1: DISCOVERY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
discover_environment()
  â†“
JobProposalEngine.generateProposals()
  â†“
Agent sees: "T020 - 95% match, 15 context files, ready to start"

PHASE 2: CLAIMING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Agent calls: claim_task({ taskId: "T020", agent: "D" })
  â†“
TaskRegistry.claimTask()
  â†“
TaskStore (ACID Transaction):
  â†’ Check: status = AVAILABLE âœ…
  â†’ Check: agent = D âœ…
  â†’ Check: dependencies satisfied âœ…
  â†’ UPDATE tasks SET status='CLAIMED', claimed_by='D', claimed_at=NOW()
  â†“
âœ… Task claimed atomically

PHASE 3: PROGRESS TRACKING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Agent calls: update_progress({ taskId: "T020", status: "IN_PROGRESS", completionPercent: 50 })
  â†“
TaskStore:
  â†’ UPDATE tasks SET status='IN_PROGRESS', completion_percent=50
  â†“
GitTracker.getFileTimestamps():
  â†’ Scans git log for T020-related files
  â†’ Found: 8 files created/modified
  â†“
âœ… Progress tracked with Git verification

PHASE 4: COMPLETION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Agent calls: complete_task({ taskId: "T020", filesCreated: ["auth.ts", "auth.test.ts"] })
  â†“
GitTracker.calculateCompletionScore():
  â†’ File score: 8/10 files created = 80% Ã— 0.7 = 56%
  â†’ Commit score: 3 commits with "T020" = 100% Ã— 0.3 = 30%
  â†’ Total: 86% â‰¥ 80% threshold âœ… AUTO-VERIFIED
  â†“
TaskRegistry.completeTask():
  â†’ UPDATE tasks SET status='COMPLETE', completed_at=NOW(), velocity=150
  â†“
DependencyResolver.findTasksToUnblock():
  â†’ Find tasks depending on T020
  â†’ Found: T025, T026
  â†’ UPDATE tasks SET status='AVAILABLE' WHERE id IN ('T025', 'T026')
  â†“
âœ… Task completed + 2 tasks auto-unblocked

PHASE 5: METRICS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SessionManager.incrementTasksCompleted()
  â†’ UPDATE agent_sessions SET tasks_completed += 1
  â†’ UPDATE agent_presence SET tasks_today += 1
  â†“
On disconnect:
SessionManager.updateDailyMetrics()
  â†’ Aggregate today's session data
  â†’ INSERT/UPDATE agent_metrics
  â†“
âœ… Metrics recorded
```

---

## ğŸ¯ MCP TOOL ROUTING MAP

```
MCP Request arrives via stdio:
  â†“
Server.setRequestHandler(CallToolRequestSchema)
  â†“
Parse: request.params.name (tool name)
  â†“
Route to appropriate tool:

â”Œâ”€ TASK TOOLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  get_available_tasks â†’ createGetAvailableTasksTool  â”‚
â”‚    â”œâ”€ Uses: TaskRegistry                            â”‚
â”‚    â””â”€ Returns: Filtered + sorted task list          â”‚
â”‚                                                      â”‚
â”‚  claim_task â†’ createClaimTaskTool                   â”‚
â”‚    â”œâ”€ Uses: TaskRegistry.claimTask()                â”‚
â”‚    â””â”€ Returns: Claim result (atomic)                â”‚
â”‚                                                      â”‚
â”‚  update_progress â†’ createUpdateProgressTool         â”‚
â”‚    â”œâ”€ Uses: TaskRegistry + GitTracker               â”‚
â”‚    â””â”€ Returns: Updated task + Git verification      â”‚
â”‚                                                      â”‚
â”‚  complete_task â†’ createCompleteTaskTool             â”‚
â”‚    â”œâ”€ Uses: TaskRegistry + GitTracker               â”‚
â”‚    â”œâ”€ Calculates: Completion score (Git)            â”‚
â”‚    â”œâ”€ Auto-unblocks: Dependent tasks                â”‚
â”‚    â””â”€ Returns: Completion result + unblocked tasks  â”‚
â”‚                                                      â”‚
â”‚  get_dashboard â†’ createGetDashboardTool             â”‚
â”‚    â”œâ”€ Uses: TaskRegistry + GitTracker               â”‚
â”‚    â””â”€ Returns: Sprint metrics (ASCII art)           â”‚
â”‚                                                      â”‚
â”‚  get_agent_status â†’ createGetAgentStatusTool        â”‚
â”‚    â”œâ”€ Uses: TaskRegistry + GitTracker               â”‚
â”‚    â””â”€ Returns: Agent workload (ASCII art)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ INTELLIGENCE TOOLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  agent_connect â†’ handleAgentConnect                 â”‚
â”‚    â”œâ”€ Uses: SessionManager.createSession()          â”‚
â”‚    â”œâ”€ Side effects: INSERT sessions, UPDATE presenceâ”‚
â”‚    â””â”€ Returns: Session UUID + welcome               â”‚
â”‚                                                      â”‚
â”‚  agent_heartbeat â†’ handleAgentHeartbeat             â”‚
â”‚    â”œâ”€ Uses: SessionManager.updateHeartbeat()        â”‚
â”‚    â”œâ”€ Side effects: UPDATE sessions + presence      â”‚
â”‚    â””â”€ Returns: ACK                                   â”‚
â”‚                                                      â”‚
â”‚  agent_disconnect â†’ handleAgentDisconnect           â”‚
â”‚    â”œâ”€ Uses: SessionManager.closeSession()           â”‚
â”‚    â”œâ”€ Side effects: UPDATE sessions, metrics        â”‚
â”‚    â””â”€ Returns: Session duration + stats             â”‚
â”‚                                                      â”‚
â”‚  get_swarm_dashboard â†’ handleGetSwarmDashboard      â”‚
â”‚    â”œâ”€ Uses: Multi-table query                       â”‚
â”‚    â”œâ”€ Side effects: Timeout detection (UPDATE)      â”‚
â”‚    â””â”€ Returns: All agent status + activity          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ DISCOVERY TOOLS â­ NEW! â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  discover_environment â†’ handleDiscoverEnvironment   â”‚
â”‚    â”œâ”€ Uses: DiscoveryEngine                         â”‚
â”‚    â”œâ”€ Orchestrates: 4 discovery components          â”‚
â”‚    â”œâ”€ Side effects:                                 â”‚
â”‚    â”‚  â”œâ”€ INSERT agents (if new)                     â”‚
â”‚    â”‚  â”œâ”€ INSERT projects (if new)                   â”‚
â”‚    â”‚  â”œâ”€ INSERT context_files (bulk)                â”‚
â”‚    â”‚  â””â”€ WRITE ~/.brain/config.json                 â”‚
â”‚    â””â”€ Returns: Complete environment package         â”‚
â”‚                                                      â”‚
â”‚  THIS IS THE PLUG-N-PLAY ENTRY POINT! ğŸš€            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ MULTI-PROJECT ARCHITECTURE

```
Central Intelligence Database (registry.db)
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROJECT 1: LocalBrain (id: uuid-aaa)                            â”‚
â”‚  â”œâ”€ Type: COMMERCIAL_APP                                         â”‚
â”‚  â”œâ”€ Tasks: 19 tasks (T001-T019)                                  â”‚
â”‚  â”œâ”€ Context: 1,334 files indexed                                 â”‚
â”‚  â”œâ”€ Swarms: 2 (Frontend Team, Backend Team)                      â”‚
â”‚  â”œâ”€ Active Agents: A, B, D (3 online)                            â”‚
â”‚  â””â”€ Recent Activity: T009 completed (Agent A, 2h ago)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROJECT 2: AudioAnalyzer (id: uuid-bbb)                         â”‚
â”‚  â”œâ”€ Type: TOOL                                                   â”‚
â”‚  â”œâ”€ Tasks: 15 tasks (auto-discovered)                            â”‚
â”‚  â”œâ”€ Context: 79 files indexed                                    â”‚
â”‚  â”œâ”€ Swarms: 1 (Processing Team)                                  â”‚
â”‚  â”œâ”€ Active Agents: None                                          â”‚
â”‚  â””â”€ Recent Activity: Project created (5 min ago)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROJECT 3: Gov.br (id: uuid-ccc)                                â”‚
â”‚  â”œâ”€ Type: COMMERCIAL_APP                                         â”‚
â”‚  â”œâ”€ Tasks: 42 tasks                                              â”‚
â”‚  â”œâ”€ Context: 2,847 files indexed                                 â”‚
â”‚  â”œâ”€ Swarms: 3 (Frontend, Backend, Gov Integration)              â”‚
â”‚  â”œâ”€ Active Agents: C, D (2 online)                               â”‚
â”‚  â””â”€ Recent Activity: T052 in progress (Agent C)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

... + 57 more projects (all 60+ projects in PROJECTS_all/)

ALL projects isolated by project_id:
  â”œâ”€ tasks.project_id
  â”œâ”€ agent_sessions.project_id
  â”œâ”€ context_files.project_id
  â””â”€ Queries scoped: WHERE project_id = ?
```

---

## ğŸ’¾ DATA STORAGE ARCHITECTURE

```
LOCAL STORAGE (Current):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ data/registry.db (SQLite)                        â”‚
â”‚  â”œâ”€ Size: 143KB â†’ Growing                           â”‚
â”‚  â”œâ”€ Tables: 11 (complete schema)                    â”‚
â”‚  â”œâ”€ Performance: <50ms per query                    â”‚
â”‚  â”œâ”€ Transactions: ACID-compliant                    â”‚
â”‚  â””â”€ Location: 01_CODEBASES/mcp-servers/...          â”‚
â”‚                                                      â”‚
â”‚  ğŸ“ ~/.brain/config.json (Agent Identity)            â”‚
â”‚  â”œâ”€ Tracking ID                                     â”‚
â”‚  â”œâ”€ Agent ID                                        â”‚
â”‚  â””â”€ Registration timestamp                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CLOUD STORAGE (Future - T006-T011):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜ï¸ PostgreSQL (Railway/Supabase)                    â”‚
â”‚  â”œâ”€ Tasks, projects, agents, sessions               â”‚
â”‚  â”œâ”€ Multi-region replication                        â”‚
â”‚  â””â”€ Auto-backups                                    â”‚
â”‚                                                      â”‚
â”‚  â˜ï¸ Redis (Railway/Upstash)                          â”‚
â”‚  â”œâ”€ Session cache                                   â”‚
â”‚  â”œâ”€ Real-time presence                              â”‚
â”‚  â””â”€ Rate limiting                                   â”‚
â”‚                                                      â”‚
â”‚  â˜ï¸ S3/GCS/R2 (Context Storage)                      â”‚
â”‚  â”œâ”€ All context files                               â”‚
â”‚  â”œâ”€ Versioned storage                               â”‚
â”‚  â””â”€ CDN distribution                                â”‚
â”‚                                                      â”‚
â”‚  â˜ï¸ Vector Database (Pinecone/Supabase pgvector)     â”‚
â”‚  â”œâ”€ Embeddings for semantic search                  â”‚
â”‚  â”œâ”€ Context similarity queries                      â”‚
â”‚  â””â”€ Knowledge graph relationships                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ COMPLETE SYSTEM STATISTICS

### **Code Metrics:**
```
Total Lines of Code: ~7,100 LOC
  â”œâ”€ Original system: 5,600 LOC
  â””â”€ Discovery Engine: 1,500 LOC (new)

Files: 35+ TypeScript files
  â”œâ”€ Core: index.ts
  â”œâ”€ Registry: 4 files
  â”œâ”€ Intelligence: 1 file
  â”œâ”€ Discovery: 5 files â­
  â”œâ”€ Tools: 17 files
  â”œâ”€ Types: 1 file
  â””â”€ Utils: 1 file

Database:
  â”œâ”€ Tables: 11
  â”œâ”€ Migrations: 5
  â”œâ”€ Indexes: 35+
  â””â”€ Foreign Keys: 15
```

### **Functional Coverage:**
```
âœ… Task Management: 100%
âœ… Agent Intelligence: 100%
âœ… Discovery Engine: 100% â­
âš ï¸ Keep-in-Touch Gating: 20% (heartbeat only)
âŒ Context Cloud Upload: 0%
âŒ Model Recommendation: 0%
âŒ Best Practices: 0%
âŒ CLI Tool: 0%

Overall: ~15% of complete vision
Foundation: 85% complete
```

### **Test Coverage:**
```
Manual Tests: 4 files
  â”œâ”€ test-intelligence.cjs
  â”œâ”€ test-bug-fixes.cjs
  â”œâ”€ test-auto-heartbeat.cjs
  â””â”€ test-discovery-engine.cjs â­

Automated Tests: 0%
CI/CD: Not configured
Coverage Reporting: None
```

---

**System Map Created By**: Agent D (Integration Specialist)
**Complexity**: 11 tables, 11 tools, 5 subsystems, 15 FK relationships
**Status**: âœ… COMPLETE ARCHITECTURE MAPPED
**Next**: Production README.md for GitHub
