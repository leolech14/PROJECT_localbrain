#
#  Python Docker Template
#  LocalBrain - Secure Python Execution Environment
#
#  Created by Claude Code Team
#  Date: 2025-10-05
#

FROM python:3.11-slim

# Set environment variables
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1

# Create non-root user for security
RUN groupadd -r localbrain && \
    useradd -r -g localbrain -u 1000 -s /bin/bash localbrain

# Install system dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        build-essential \
        curl \
        git \
        && rm -rf /var/lib/apt/lists/*

# Create workspace directory
WORKDIR /workspace

# Set up Python environment
RUN python -m pip install --upgrade pip

# Install common Python packages for data science and development
RUN pip install --no-cache-dir \
    numpy==1.24.3 \
    pandas==2.0.3 \
    matplotlib==3.7.2 \
    requests==2.31.0 \
    scipy==1.11.1 \
    scikit-learn==1.3.0 \
    jupyter==1.0.0 \
    flask==2.3.2 \
    pytest==7.4.0 \
    black==23.7.0 \
    flake8==6.0.0

# Create directories for the application
RUN mkdir -p /workspace/{code,input,output,temp,logs} && \
    chown -R localbrain:localbrain /workspace

# Switch to non-root user
USER localbrain

# Set default command
CMD ["python3", "--version"]

# Labels for metadata
LABEL maintainer="LocalBrain" \
      version="1.0.0" \
      description="Secure Python execution environment for LocalBrain" \
      security.level="restricted" \
      localbrain.template="python-3.11"